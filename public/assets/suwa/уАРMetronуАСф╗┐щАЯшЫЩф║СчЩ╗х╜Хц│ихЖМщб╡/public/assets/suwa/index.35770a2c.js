var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,o=(t,o)=>{for(var n in o||(o={}))s.call(o,n)&&a(t,n,o[n]);if(e)for(var n of e(o))i.call(o,n)&&a(t,n,o[n]);return t};import{R as n}from"./vendor.85072618.js";var r=(t=>(t[t.init=0]="init",t[t.success=1]="success",t[t.error=-1]="error",t))(r||{}),l=(t=>(t.show="block",t.hidden="none",t))(l||{}),h=(t=>(t.auto="auto",t.manual="manual",t))(h||{}),d=(t=>(t.top="top",t.bottom="bottom",t))(d||{}),p=(t=>(t.none="none",t.inline="inline",t.outline="outline",t))(p||{}),c=(t=>(t.hover="hover",t.static="static",t))(c||{}),m="/m/assets/loading.3ed683e0.svg",u="/m/assets/arrow-right.8022e282.svg";class g extends n.Component{constructor(t){super(t),this.state={originX:0,offsetX:0,originY:0,totalY:0,validated:r.init,isMoving:!1,isTouchEndSpan:!1,imgDisplayStatus:l.hidden,otherHeight:0,isSliderHover:!1},this.maxSlidedWidth=0,this.getClientX=t=>t.type.indexOf("mouse")>-1?t.clientX:t.type.indexOf("touch")>-1?t.touches[0].clientX:void 0,this.getClientY=t=>t.type.indexOf("mouse")>-1?t.clientY:t.type.indexOf("touch")>-1?t.touches[0].clientY:void 0,this.move=t=>{const e=this.getClientX(t),s=this.getClientY(t);let i=e-this.state.originX;const a=Math.abs(s-this.state.originY),o=this.state.totalY+a;i>0&&(i>this.maxSlidedWidth&&(i=this.maxSlidedWidth),this.setState({offsetX:i,totalY:o}))},this.validatedSuccess=t=>{this.setState({validated:r.success},(()=>{t(),this.props.reset===h.auto&&setTimeout((()=>{this.resetCaptcha()}),500)}))},this.validatedFail=t=>{this.setState({validated:r.error},(()=>{t(),this.props.reset===h.auto&&setTimeout((()=>{this.resetCaptcha()}),500)}))},this.handleTouchStart=t=>{this.state.isTouchEndSpan||this.props.isLoading||(this.handleMoveOver(),this.setState({originX:this.getClientX(t),originY:this.getClientY(t)}))},this.handleTouchMove=t=>{this.state.isTouchEndSpan||this.props.isLoading||(this.move(t),this.setState({isMoving:!0}))},this.handleTouchEnd=t=>{if(!this.state.isTouchEndSpan&&!this.props.isLoading){if(this.state.totalY<(this.props.robotValidate&&this.props.robotValidate.offsetY||0))return this.props.robotValidate&&this.props.robotValidate.handler&&this.state.isMoving?(this.props.robotValidate&&this.props.robotValidate.handler&&this.props.robotValidate.handler(),void this.resetCaptcha()):void this.setState({offsetX:0,originX:0,originY:0,totalY:0,isTouchEndSpan:!1,isMoving:!1,validated:r.error},(()=>{this.handleMoveOut(t)}));if(this.state.offsetX>0){const t=this.state.offsetX/this.maxSlidedWidth;this.setState({isTouchEndSpan:!0,isMoving:!1}),this.props.onRequest&&this.props.onRequest(t,this.validatedSuccess,this.validatedFail,this.resetCaptcha)}}},this.resetCaptcha=(t=!0)=>{const e=this.maxSlidedWidth/30,s=()=>{const i=this.state.offsetX,a=i<e?0:i-e;i>0?this.setState({offsetX:a},(()=>{window.requestAnimationFrame(s)})):this.setState({offsetX:0,originX:0,originY:0,totalY:0,isTouchEndSpan:!1,isMoving:!1,validated:r.init,imgDisplayStatus:l.hidden,isSliderHover:!1},(()=>{this.props.onReset&&t&&this.props.onReset()}))};window.requestAnimationFrame(s)},this.renderImage=()=>({slidedImageValue:this.props.slidedImage,slidedImageSuccessValue:this.props.slidedImageSuccess,slidedImageErrorValue:this.props.slidedImageError,slidedImageMoving:this.props.slidedImageMoving,slidedImageLoading:this.props.slidedImageLoading}),this.renderCtrlClassName=(t,e,s,i,a)=>{let o,n=t;return this.state.isMoving?(o="slider-moving",n=i):this.state.isTouchEndSpan?this.state.validated===r.success?(o="slider-end slider-success",n=e):this.state.validated===r.error?(o="slider-end slider-error",n=s):(o="slider-moving",n=a):this.state.validated===r.init&&this.state.isSliderHover?(o="slider-moving",n=i):o="",{ctrlClassName:o,slidedImage:n}},this.handlerMouseDown=t=>{t.preventDefault(),this.state.isTouchEndSpan||this.props.isLoading||this.setState({originX:this.getClientX(t),originY:this.getClientY(t),isMoving:!0})},this.handlerMouseMove=t=>{t.preventDefault(),this.state.isTouchEndSpan||this.props.isLoading||this.state.isMoving&&this.move(t)},this.handlerMouseUp=t=>{t.preventDefault(),this.state.isTouchEndSpan||this.props.isLoading||(this.setState({isMoving:!1}),this.handleTouchEnd(t))},this.handleMoveOut=t=>{t.preventDefault(),this.state.validated===r.init&&this.setState({isSliderHover:!1}),this.state.imgDisplayStatus===l.show&&!1===this.state.isMoving&&this.state.validated===r.init&&this.setState({imgDisplayStatus:l.hidden})},this.handleMoveOver=()=>{this.state.validated===r.init&&this.setState({isSliderHover:!0}),this.state.imgDisplayStatus===l.hidden&&this.setState({imgDisplayStatus:l.show})},this.listenMouseUp=t=>{!0===this.state.isMoving&&this.handlerMouseUp(t)},this.listenMouseMove=t=>{this.handlerMouseMove(t)}}componentDidMount(){document.addEventListener("mouseup",this.listenMouseUp),document.addEventListener("mousemove",this.listenMouseMove),this.timeout=setTimeout((()=>{this.maxSlidedWidth=this.ctrlWidth.clientWidth-this.sliderWidth.clientWidth;const t=this.reset&&this.props.resetButton===p.outline?this.reset.clientHeight+1:0;this.setState({otherHeight:this.ctrlWidth.clientHeight+t+1})}),200)}UNSAFE_componentWillReceiveProps(t){t.reset===h.manual&&this.resetCaptcha(!1)}componentWillUnmount(){document.removeEventListener("mouseup",this.listenMouseUp),document.removeEventListener("mousemove",this.listenMouseMove),clearTimeout(this.timeout),this.timeout=null}render(){const{slidedImageValue:t,slidedImageSuccessValue:e,slidedImageErrorValue:s,slidedImageMoving:i,slidedImageLoading:a}=this.renderImage(),{ctrlClassName:h,slidedImage:m}=this.renderCtrlClassName(t,e,s,i,a);let u,g,v,S,M;this.props.displayType===c.hover?(g={display:this.state.imgDisplayStatus},M=this.props.hoverPanelClassName||null,u=this.props.imagePosition===d.top?{position:"absolute",bottom:`${this.state.otherHeight}px`}:{position:"absolute",top:`${this.state.otherHeight}px`}):g={display:l.show},v=this.props.resetButtonElement?this.props.resetButtonElement:this.props.resetButton===p.outline?n.createElement("button",{className:"reset-btn"}):this.props.resetButton===p.inline?n.createElement("img",{className:"reset-btn",src:"/m/assets/reload.38a3e17c.svg"}):null,S=this.state.isMoving?this.props.isLoading?"加载中...":null:this.props.isLoading?"加载中...":this.state.isTouchEndSpan?null:this.props.tipsText,this.state.validated!==r.init&&(S=null);return n.createElement("div",{className:`slideCaptchaContainer ${this.props.containerClassName?this.props.containerClassName:""}`,onMouseMove:this.handlerMouseMove,onMouseUp:this.handlerMouseUp},(()=>n.createElement("div",{className:""+(M?`panel ${M}`:"panel"),style:o(o({},u),g)},this.props.isLoading?n.createElement("div",{className:"loadingContainer"},this.props.loadingIcon):n.createElement("div",{className:"bgContainer"},n.createElement("img",{src:this.props.bgUrl,className:"bgImg"}),n.createElement("img",{src:this.props.puzzleUrl,className:"puzzleImg",style:{left:`${this.state.offsetX}px`}})),this.props.resetButton===p.inline?n.createElement("div",{className:"reset reset-inline",ref:t=>{this.reset=t}},n.createElement("div",{className:"rest-container",onClick:()=>this.resetCaptcha()},v)):null))(),n.createElement("div",null,n.createElement("div",{className:`control ${h||""}`,ref:t=>{this.ctrlWidth=t}},n.createElement("div",{className:"slided",style:{width:`${this.state.offsetX}px`}}),n.createElement("div",{className:"pl-8 slider",ref:t=>{this.sliderWidth=t},style:{left:`${this.state.offsetX}px`},onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd,onMouseDown:this.handlerMouseDown,onMouseOver:this.handleMoveOver,onMouseOut:this.handleMoveOut},m),n.createElement("div",{className:`tips ${this.props.tipsClassName?this.props.tipsClassName:""}`},n.createElement("span",null,S)))))}}g.defaultProps={displayType:c.hover,reset:h.auto,resetButton:p.none,imagePosition:d.bottom,tipsText:"向右滑动滑块填充拼图",isLoading:!1,slidedImage:n.createElement("img",{src:u,style:{width:"22px"}}),slidedImageSuccess:n.createElement("img",{src:"/m/assets/check.d514334d.svg",style:{width:"22px"}}),slidedImageMoving:n.createElement("img",{src:u,style:{width:"22px"}}),slidedImageError:n.createElement("img",{src:"/m/assets/cross.bc68bd4f.svg",style:{width:"22px"}}),slidedImageLoading:n.createElement("img",{src:m,style:{width:"22px"}}),loadingIcon:n.createElement("img",{src:m,className:"slideCaptchaLoading"})};export{g as S};
